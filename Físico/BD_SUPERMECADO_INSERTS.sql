USE BD_SUPERMERCADO_FUNCIONARIO_PRODUTO_CONSUMIDOR;

INSERT INTO SUPERMERCADO (SUP_CNPJ, SUP_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL, SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_EDERECO_CIDADE, SUP_ENDERECO_ESTADO)
VALUES ("12345678000101", "Supermercado Grick", "(19) 3456-7890", "gricktambau@email.com", "Grick Street", "10000", "TambaCity", "SP");

INSERT INTO SUPERMERCADO (SUP_CNPJ, SUP_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL, SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_EDERECO_CIDADE, SUP_ENDERECO_ESTADO)
VALUES ("98765432000102", "Supermercado BomPreço", "(19) 3344-5566", "contato@bompreco.com", "Rua das Flores", "250", "Campinas", "SP");

INSERT INTO SUPERMERCADO (SUP_CNPJ, SUP_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL, SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_EDERECO_CIDADE, SUP_ENDERECO_ESTADO)
VALUES ("11223344000103", "Supermercado Econômico", "(16) 4002-8922", "vendas@economico.com", "Avenida Central", "785", "Ribeirão Preto", "SP");

INSERT INTO SUPERMERCADO (SUP_CNPJ, SUP_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL, SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_EDERECO_CIDADE, SUP_ENDERECO_ESTADO)
VALUES ("99887766000104", "Supermercado Popular", "(15) 3222-4455", "suporte@popular.com", "Rua das Palmeiras", "45", "Sorocaba", "SP");

INSERT INTO SUPERMERCADO (SUP_CNPJ, SUP_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL, SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_EDERECO_CIDADE, SUP_ENDERECO_ESTADO)
VALUES ("55443322000105", "Supermercado MaisBarato", "(11) 98877-6655", "contato@maisbarato.com", "Avenida Paulista", "1500", "São Paulo", "SP");


INSERT INTO PRODUTO (PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES ("7891234567890", "Arroz 5Kg", 5.0, 500, 26.90, "2025-12-25");

INSERT INTO PRODUTO (PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES ("7899876543210", "Feijão Carioca 1Kg", 1.0, 300, 8.50, "2026-01-15");

INSERT INTO PRODUTO (PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES ("7891122334455", "Óleo de Soja 900ml", 0.9, 400, 7.20, "2025-08-10");

INSERT INTO PRODUTO (PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES ("7895566778899", "Açúcar Refinado 1Kg", 1.0, 350, 4.30, "2026-03-30");

INSERT INTO PRODUTO (PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES ("7893344556677", "Café Torrado e Moído 500g", 0.5, 200, 12.90, "2025-11-20");


INSERT INTO CONSUMIDOR(CON_CPF, CON_NOME, CON_EMAIL, CON_TELEFONE)
VALUES("48916305829", "Maria Clara Uliana Braga", "mc0250532@gmail.com", "19989937118");

INSERT INTO CONSUMIDOR(CON_CPF, CON_NOME, CON_EMAIL, CON_TELEFONE)
VALUES("35791246805", "João Pedro Silva", "joaopedro.silva@gmail.com", "19988877655");

INSERT INTO CONSUMIDOR(CON_CPF, CON_NOME, CON_EMAIL, CON_TELEFONE)
VALUES("76423019540", "Ana Beatriz Ramos", "anabeatriz.ramos@gmail.com", "21991234567");

INSERT INTO CONSUMIDOR(CON_CPF, CON_NOME, CON_EMAIL, CON_TELEFONE)
VALUES("09247586133", "Carlos Eduardo Moreira", "carlos.moreira99@gmail.com", "11997766554");

INSERT INTO CONSUMIDOR(CON_CPF, CON_NOME, CON_EMAIL, CON_TELEFONE)
VALUES("68130497256", "Beatriz Santos Oliveira", "beatriz.s.oliveira@gmail.com", "31998877666");


INSERT INTO FUNCIONARIO(FUN_CPF, FUN_NOME, FUN_DATA_NASCIMENTO, FUN_TELEFONE, FUN_EMAIL, FUN_CARTEIRA_TRABALHO, FUN_BANCO_AGENCIA, FUN_BANCO_CONTA, FUN_DATA_ADMISSAO, FUN_JORNADA_TRABALHPO, FK_SUP_CNPJ)
VALUES("12345698734", "José Vanderlei", "1985-03-12","11987654321","zevanderlei@email.com","carteira_ze_varderlei","1234","56789","2020-01-15","44horas","12345678000101");

INSERT INTO FUNCIONARIO(FUN_CPF, FUN_NOME, FUN_DATA_NASCIMENTO, FUN_TELEFONE, FUN_EMAIL, FUN_CARTEIRA_TRABALHO, FUN_BANCO_AGENCIA, FUN_BANCO_CONTA, FUN_DATA_ADMISSAO, FUN_JORNADA_TRABALHPO, FK_SUP_CNPJ)
VALUES("45678912300", "Maria Eduarda Costa", "1992-08-25", "21998877665", "maria.eduarda@email.com", "carteira_maria_eduarda", "2345", "67890", "2021-05-10", "40horas", "98765432000102");

INSERT INTO FUNCIONARIO(FUN_CPF, FUN_NOME, FUN_DATA_NASCIMENTO, FUN_TELEFONE, FUN_EMAIL, FUN_CARTEIRA_TRABALHO, FUN_BANCO_AGENCIA, FUN_BANCO_CONTA, FUN_DATA_ADMISSAO, FUN_JORNADA_TRABALHPO, FK_SUP_CNPJ)
VALUES("78945612377", "Carlos Henrique Souza", "1988-11-03", "11991234567", "carlos.h.souza@email.com", "carteira_carlos_henrique", "3456", "78901", "2019-09-20", "44horas", "11223344000103");

INSERT INTO FUNCIONARIO(FUN_CPF, FUN_NOME, FUN_DATA_NASCIMENTO, FUN_TELEFONE, FUN_EMAIL, FUN_CARTEIRA_TRABALHO, FUN_BANCO_AGENCIA, FUN_BANCO_CONTA, FUN_DATA_ADMISSAO, FUN_JORNADA_TRABALHPO, FK_SUP_CNPJ)
VALUES("32165498712", "Ana Carolina Ribeiro", "1997-02-14", "31997766554", "ana.ribeiro@email.com", "carteira_ana_carolina", "4567", "89012", "2022-07-01", "36horas", "99887766000104");

INSERT INTO FUNCIONARIO(FUN_CPF, FUN_NOME, FUN_DATA_NASCIMENTO, FUN_TELEFONE, FUN_EMAIL, FUN_CARTEIRA_TRABALHO, FUN_BANCO_AGENCIA, FUN_BANCO_CONTA, FUN_DATA_ADMISSAO, FUN_JORNADA_TRABALHPO, FK_SUP_CNPJ)
VALUES("65498732145", "Lucas Fernandes Lima", "1990-12-09", "11993456789", "lucas.lima@email.com", "carteira_lucas_fernandes", "5678", "90123", "2018-04-05", "44horas", "55443322000105");


INSERT INTO SUPERMERCADO_PRODUTO (FK_SUP_CNPJ, FK_PRO_ID)
VALUES ("12345678000101", 1); 

INSERT INTO SUPERMERCADO_PRODUTO (FK_SUP_CNPJ, FK_PRO_ID)
VALUES ("98765432000102", 2); 

INSERT INTO SUPERMERCADO_PRODUTO (FK_SUP_CNPJ, FK_PRO_ID)
VALUES ("11223344000103", 3); 

INSERT INTO SUPERMERCADO_PRODUTO (FK_SUP_CNPJ, FK_PRO_ID)
VALUES ("99887766000104", 4); 

INSERT INTO SUPERMERCADO_PRODUTO (FK_SUP_CNPJ, FK_PRO_ID)
VALUES ("55443322000105", 5); 


INSERT INTO PRODUTO_CONSUMIDOR (FK_CON_CPF, FK_PRO_ID)
VALUES ("48916305829", 1); 

INSERT INTO PRODUTO_CONSUMIDOR (FK_CON_CPF, FK_PRO_ID)
VALUES ("35791246805", 3); 

INSERT INTO PRODUTO_CONSUMIDOR (FK_CON_CPF, FK_PRO_ID)
VALUES ("76423019540", 5);

INSERT INTO PRODUTO_CONSUMIDOR (FK_CON_CPF, FK_PRO_ID)
VALUES ("09247586133", 2); 

INSERT INTO PRODUTO_CONSUMIDOR (FK_CON_CPF, FK_PRO_ID)
VALUES ("68130497256", 4); 




SELECT * FROM SUPERMERCADO;

/*
CONSULTAR O AUMENTO DE R$2,00 NO PRECO DOS PRODUTOS COM PREÇO >= R$5,00
*/

SELECT PRO_NOME AS "NOME", 
	PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS", 
    PRO_PRECO AS "PREÇO ATUAL", 
    TRUNCATE((PRO_PRECO + 2),2) AS "PREÇO COM AJUSTE DE R$2,00"
FROM PRODUTO
WHERE PRO_PRECO >=5;

/*
CONSULTAR A REDUÇÃO DE R$1,00 NO PREÇO DOS PRODUTOS COM PREÇO ATUAL ABAIXO DE R$5,00
*/
SELECT PRO_NOME AS "NOME",
	PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
    PRO_PRECO AS "PREÇO ATUAL",
    TRUNCATE((PRO_PRECO -1),2) AS "PREÇO COM REDUÇÃO DE R$1,00"
FROM PRODUTO
WHERE PRO_PRECO <= 10;

/*
CONSULTAR COMO SERIA APLICAR UM DESCONTO DE 10% EM TODOS OS PRODUTO
*/
SELECT PRO_NOME AS "NOME",
	PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
    (PRO_PRECO - (PRO_PRECO * 0.1)) AS "PREÇO COM DESCONTO DE 10%"
FROM PRODUTO;

/*
AJUSTAR O ESTOQUE DO PRIMEIRO PRODUTO, DIVIDINDO PELA METADE
*/
SELECT PRO_ID
	PRO_NOME,
	PRO_CODIGO_BARRAS,
    PRO_QUANTIDADE
FROM PRODUTO;

UPDATE PRODUTO
SET PRO_QUANTIDADE = PRO_QUANTIDADE/2
WHERE PRO_ID = 1;


/* CONSULTAR TODOS OS PRODUTOS QUE TENHAM DATA DE VALIDADE ENTRE SETEMBRO DE 2025 E DEZEMBRO DE 2025*/
SELECT PRO_NOME AS "NOME",
	   PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
       PRO_DATA_VALIDADE AS "DATA DE VALIDADE"
FROM PRODUTO
WHERE PRO_DATA_VALIDADE BETWEEN '2025-09-01' AND '2025-12-31';

/*CONSULTAR TODOS OS PRODUTOS QUE TENHAM PREÇO MAIOR QUE R$10 OU MENOR QUE R$4*/
SELECT PRO_NOME AS "NOME",
	   PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
       PRO_PRECO AS "PREÇO"
FROM PRODUTO
WHERE PRO_PRECO >= 10 OR PRO_PRECO<=4;

/*CONSULTAR OS DDS E TELEFONES DOS CONSUMIDORES SEPARADAMENTE*/
SELECT CON_NOME AS "NOME DO CONSUMIDOR",
	   CON_CPF AS "CPF DO CONSUMIDOR",
       SUBSTRING(CON_TELEFONE,1,2) AS "DDD DO TEELFONE",
       SUBSTRING(CON_TELEFONE,3,9)AS "NÚMERO DO TELEFONE"
FROM CONSUMIDOR;

/*GERAR UMA FRASE CONCATENANDO: RAZÃO SOCIAL, CNPJ, TELEFONE E EMAIL*/
SELECT CONCAT("RAZÃO SOCIAL:",
		CONCAT(SUP_RAZAO_SOCIAL,
			CONCAT("|CNPJ:",
				CONCAT(SUP_CNPJ,
					CONCAT("| TELEFONE:",
						CONCAT(SUP_TELEFONE,
							CONCAT("| EMAIL:", SUP_EMAIL))))))) AS FRASE
FROM SUPERMERCADO;

/* GERAR UMA CONSULTA QUE VERIFICA O peso DOS PRODUTOS.
RETORNAR: NOME, CODIGO DE BARRAS, QUANTIDADE, PESO E DATA DE VALIDADE
REGRAS:
1) PESO <=5: PESO BAIXO
2) PESO >5 E QUANTIDADE <=50: PESO MÉDIO
3) PESO >50 PESO ALTO */
SELECT PRO_NOME AS "NOME DO PRODUTO",
	   PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
       PRO_QUANTIDADE AS "QUANTIDADE",
       PRO_DATA_VALIDADE AS "DATA DE VALIDADE",
       PRO_PESO AS "PESO DO PRODUTO",
       CASE
			WHEN PRO_PESO <=5 THEN "PESO BAIXO"
			WHEN PRO_PESO >5 AND PRO_PESO <= 50 THEN "PESO MÉDIO"
			WHEN PRO_PESO >50 THEN "PESO ALTO"
	   END AS "CLASSIFICAÇÃO DO PESO"
FROM   PRODUTO;

/* CONATR QUANTOS CONSUMIDORES TEMOS CADASTRADOS*/
SELECT COUNT(*)
FROM CONSUMIDOR;

/* CONATR QUANTOS SUPERMERCADOS TEMOS CADASTRADOS*/
SELECT COUNT(*)
FROM SUPERMERCADO;

/* CONATR QUANTOS FUNCIONARIOS TEMOS CADASTRADOS*/
SELECT COUNT(*)
FROM FUNCIONARIO;

/* CONATR QUANTOS PRODUTOS TEMOS CADASTRADOS*/
SELECT COUNT(*)
FROM PRODUTO;

/* SOMAR O PREÇO TOTAL DE TODOS OS PRODUTOS CADASTRADOS*/
SELECT SUM(PRO_PRECO)
FROM PRODUTO;

SELECT CONCAT("R$" , TRUNCATE(SUM(PRO_PRECO),2))AS "SOMA TOTAL"
FROM PRODUTO;


/*CALCULAR A MÉDIA DE PRECO DOS PRODUTOS*/
SELECT AVG(PRO_PRECO)
FROM PRODUTO;

SELECT CONCAT("R$" , TRUNCATE(AVG(PRO_PRECO),2)) AS "MÉDIA DE PREÇO"
FROM PRODUTO;

/*SELECIONAR O PRODUTO MAIS CARO*/
SELECT MAX(PRO_PRECO)
FROM PRODUTO;

/*SELECIONAR O ESTOQUE COM MAIOR QUANTIDADE*/
SELECT MAX(PRO_QUANTIDADE)
FROM PRODUTO;

/*SELCIONAR O PRODUTO MAIS BARATO*/
SELECT MIN(PRO_PRECO)
FROM PRODUTO;

/*SELECIONAR O ESTOQUE COM MENOR QUANTIDADE*/
SELECT MIN(PRO_QUANTIDADE)
FROM PRODUTO;

/*SELECIONAR A DATA E HORA ATUAL*/
SELECT NOW()FROM DUAL;

SELECT FUN_NOME AS "NOME DO FUNCIONÁRIO",
		DATE_FORMAT(FUN_DATA_NASCIMENTO, "%d/%m/%Y") AS "DATA DE NASCIMENTO",
        TIMESTAMPDIFF(YEAR,FUN_DATA_NASCIMENTO, NOW()) AS "IDADE"
FROM FUNCIONARIO;

/*FUNÇÕES MATEMÁTICAS
ABS - VALOR ABSOLUO DE UM NÚMERO
ROUND - ARRENDOAR 
POWER - POTÊNCIA*/
SELECT  ABS(-10),
		ROUND(PRO_PRECO) AS "PREÇO ARREDONDADO",
        POWER(PRO_PRECO,2) AS "PREÇO ELEVADO AO QUADRADO"
FROM 	PRODUTO;

/*UPPER, LOWER, TRIM*/
SELECT  UPPER(FUN_NOME) AS "MAIÚSCULAS",
		LOWER(FUN_NOME) AS "MINÚSCULAS",
        TRIM("              Maria Clara") AS "TIRANDO ESPAÇOS"
FROM    FUNCIONARIO;

/*GROUP BY*/
SELECT  PRO_QUANTIDADE,
		COUNT(*) AS "PREPETIÇÕES"
FROM	PRODUTO
GROUP BY PRO_QUANTIDADE;

/*UNION*/
SELECT	FUN_NOME,
		FUN_CPF
FROM	FUNCIONARIO
UNION
SELECT	FUN_NOME,
		FUN_CPF
FROM	FUNCIONARIO;

SELECT * FROM PRODUTO;

/*UNION*/
SELECT	PRO_NOME
FROM	PRODUTO
UNION
SELECT	"Arroz 5Kg"
FROM	DUAL
UNION 
SELECT	"Iorgut do Bob Esponja"
FROM	DUAL;

/*UNION ALL*/
SELECT	PRO_NOME
FROM	PRODUTO
UNION	ALL
SELECT	"Arroz 5Kg"
FROM	DUAL
UNION 	ALL
SELECT	"Iorgut do Bob Esponja"
FROM	DUAL;

/*SELECT COM WHERE*/
SELECT	FUN_NOME		AS	"NOME DO FUNCIONARIO",
		FUN_CPF			AS	"CPF DO FUNIONARIO",
		FUN_DATA_NASCIMENTO AS "DATA DE NASCIMENTO",
        TIMESTAMPDIFF(YEAR, FUN_DATA_NASCIMENTO,NOW()) AS "IDADE"
FROM FUNCIONARIO
WHERE TIMESTAMPDIFF(YEAR, FUN_DATA_NASCIMENTO,NOW()) >=25
AND  TIMESTAMPDIFF(YEAR, FUN_DATA_NASCIMENTO,NOW()) <=35;

/*RETORNAR OS FUNCIONARIOS, CONSUMIDORES E SUPERMERCADOS
COM EMAIL INGUAL A HOTMAIL OU OUTLOOK*/
SELECT	CON_NOME		AS"NOME",
		CON_CPF			AS"CPF/CNPJ",
        CON_TELEFONE	AS"TELEFONE",
        CON_EMAIL		AS"EMAIL",
        "CONSUMIDOR"	AS"TIPO"
FROM	CONSUMIDOR
WHERE	UPPER(CON_EMAIL) LIKE "%HOTMAIL%"
OR 		UPPER(CON_EMAIL) LIKE "%OUTLOOK%"
UNION
SELECT	FUN_NOME			AS"NOME",
		FUN_CPF				AS"CPF/CNPJ",
        FUN_TELEFONE		AS"TELEFONE",
        FUN_EMAIL			AS"EMAIL",
        "FUNCIONARIO"		AS"TIPO"
FROM	FUNCIONARIO
WHERE	UPPER(FUN_EMAIL) LIKE "%HOTMAIL%"
OR 		UPPER(FUN_EMAIL) LIKE  "%OUTLOOK%"
UNION
SELECT	SUP_RAZAO_SOCIAL			AS"NOME",
		SUP_CNPJ					AS"CPF/CNPJ",
        SUP_TELEFONE				AS"TELEFONE",
        SUP_EMAIL					AS"EMAIL",
        "SUPERMERCADO"				AS"TIPO"
FROM	SUPERMERCADO
WHERE	UPPER(SUP_EMAIL) LIKE "%HOTMAIL%"
OR 		UPPER(SUP_EMAIL) LIKE  "%OUTLOOK%";

/*CROSS JOIN:
RETORNAR TODOS OS PRODUTOS E OS SUPERMERCADOS EM QUE SÃO VENDIDOS*/
SELECT 	PRODUTO.PRO_NOME 					AS "NOME",
		PRODUTO.PRO_CODIGO_BARRAS 			AS "CODIGO DE BARRAS",
		SUPERMERCADO.SUP_RAZAO_SOCIAL	 	AS "RAZÃO SOCIAL"
FROM	SUPERMERCADO_PRODUTO
CROSS JOIN SUPERMERCADO
CROSS JOIN PRODUTO
WHERE 	PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID
AND		SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ;

/*INNER JOING
RETORNAR ApENAS OS PRODUTOS QUE FORAM COMPRADOS POR ALGUM CONSUMIDOR*/
SELECT		PRODUTO_CONSUMIDOR.PCO_ID AS "ID DA CONTA",
			PRODUTO.PRO_NOME AS "NOME DO PRODUTO",
            PRODUTO.PRO_CODIGO_BARRAS AS "CODIGO DE BARRAS",
            CONSUMIDOR.CON_NOME AS "NOME DO CONSUMIDOR",
            CONSUMIDOR.CON_CPF AS "CPF DO CONSUMIDOR"
FROM		PRODUTO_CONSUMIDOR 
INNER JOIN PRODUTO ON (PRODUTO_CONSUMIDOR.FK_PRO_ID = PRODUTO.PRO_ID)
INNER JOIN CONSUMIDOR ON(PRODUTO_CONSUMIDOR.FK_CON_CPF = CONSUMIDOR.CON_CPF);

/*EXERCICIO COM INNER JOIN
RETORNAR APENAS OS FUNCIONARIOS QUE TRABALHAM EM UM SUPERMERCADOS
RETORNAR O NOME DO FUNCIONARIO E O NOME DO SUPERMERCADO QUE ELE TRABALHA*/
SELECT		SUPERMERCADO.SUP_RAZAO_SOCIAL AS "RAZAO SOCIAL",
			FUNCIONARIO.FUN_NOME AS "NOME DO FUNCIONARIO"
FROM		SUPERMERCADO
INNER JOIN	FUNCIONARIO ON(SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*EXERCICIO 2 COM INNER JOIN
RETORNAR APENAS OS PRODUTOS QUE EXISTAM EM UM SUPERMERCADO
RETORNAR O NOME DO PRODUTO E O NOME DO SUPERMERCADO QUE ELE ESTÁ DISPONIVEL*/
SELECT		PRODUTO.PRO_NOME AS "NOME DO PRODUTO",
			SUPERMERCADO.SUP_RAZAO_SOCIAL AS "RAZAO SOCIAL"
FROM 		SUPERMERCADO_PRODUTO
INNER JOIN PRODUTO ON(PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
INNER JOIN SUPERMERCADO ON (SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

/*LEFT JOIN*/
INSERT INTO PRODUTO(PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO,PRO_QUANTIDADE,PRO_PRECO,PRO_DATA_VALIDADE)
VALUES ("33333333","KITKAT","30","1500",4.50,"2026-01-01");
SELECT	PRODUTO.PRO_NOME,
		SUPERMERCADO.SUP_RAZAO_SOCIAL
FROM	PRODUTO
LEFT JOIN SUPERMERCADO_PRODUTO ON(PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
LEFT JOIN SUPERMERCADO ON(SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

SELECT	PRODUTO.PRO_NOME,
		SUPERMERCADO.SUP_RAZAO_SOCIAL
FROM	PRODUTO
RIGHT JOIN SUPERMERCADO_PRODUTO ON(PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
RIGHT JOIN SUPERMERCADO ON(SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

/*SELECT COM LEFT JOIN E RIGHT JOIN*/
SELECT *
FROM (
		SELECT	S.SUP_RAZAO_SOCIAL 	AS RAZAO_SOCIAL,
				F.FUN_NOME 			AS NOME_FUNCIONARIO,
                P.PRO_NOME 			AS NOME_PRODUTO,
                C.CON_NOME			AS NOME_CONSUMIDOR
		FROM	SUPERMERCADO S
        LEFT JOIN FUNCIONARIO F 			ON (S.SUP_CNPJ = F.FK_SUP_CNPJ)
        LEFT JOIN SUPERMERCADO_PRODUTO SP 	ON(S.SUP_CNPJ = SP.FK_SUP_CNPJ)
        LEFT JOIN PRODUTO P 				ON (SP.FK_PRO_ID = P.PRO_ID)
        LEFT JOIN PRODUTO_CONSUMIDOR PC 	ON(P.PRO_ID = PC.FK_PRO_ID)
        LEFT JOIN CONSUMIDOR C 				ON (PC.FK_CON_CPF = C.CON_CPF)
        UNION
        SELECT	S.SUP_RAZAO_SOCIAL 	AS RAZAO_SOCIAL,
				F.FUN_NOME 			AS NOME_FUNCIONARIO,
                P.PRO_NOME 			AS NOME_PRODUTO,
                C.CON_NOME			AS NOME_CONSUMIDOR
		FROM	SUPERMERCADO S
        RIGHT JOIN FUNCIONARIO F 			ON (S.SUP_CNPJ = F.FK_SUP_CNPJ)
        RIGHT JOIN SUPERMERCADO_PRODUTO SP 	ON(S.SUP_CNPJ = SP.FK_SUP_CNPJ)
        RIGHT JOIN PRODUTO P 				ON (SP.FK_PRO_ID = P.PRO_ID)
        RIGHT JOIN PRODUTO_CONSUMIDOR PC 	ON(P.PRO_ID = PC.FK_PRO_ID)
        RIGHT JOIN CONSUMIDOR C 			ON (PC.FK_CON_CPF = C.CON_CPF)
) SELECT_EXTERNO
ORDER BY	SELECT_EXTERNO.RAZAO_SOCIAL		ASC,
			SELECT_EXTERNO.NOME_FUNCIONARIO DESC,
            SELECT_EXTERNO.NOME_PRODUTO 	ASC,
            SELECT_EXTERNO.NOME_CONSUMIDOR	DESC;
            
/*Atividade*/
/*1 RETORNAR TODOS OS PRODUTOS E OS SUPERMERCADOS EM QUE SÃO VENDIDOS*/
SELECT 	PRODUTO.PRO_NOME 					AS "NOME",
		SUPERMERCADO.SUP_RAZAO_SOCIAL	 	AS "RAZÃO SOCIAL"
FROM	SUPERMERCADO_PRODUTO
INNER JOIN PRODUTO ON 	(PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID)
INNER JOIN SUPERMERCADO ON(SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ);

/*2 RETORNAR O NOME DO FUNCIONARIO E O NOME DO SUPERMERCADO*/
SELECT		SUPERMERCADO.SUP_RAZAO_SOCIAL AS "RAZAO SOCIAL",
			FUNCIONARIO.FUN_NOME AS "NOME DO FUNCIONARIO"
FROM		SUPERMERCADO
INNER JOIN	FUNCIONARIO ON(SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*INNER JOING
3 RETORNAR ApENAS OS PRODUTOS QUE FORAM COMPRADOS POR ALGUM CONSUMIDOR*/
SELECT		PRODUTO_CONSUMIDOR.PCO_ID AS "ID DA CONTA",
			PRODUTO.PRO_NOME AS "NOME DO PRODUTO",
            CONSUMIDOR.CON_NOME AS "NOME DO CONSUMIDOR"
FROM		PRODUTO_CONSUMIDOR 
INNER JOIN PRODUTO ON (PRODUTO_CONSUMIDOR.FK_PRO_ID = PRODUTO.PRO_ID)
INNER JOIN CONSUMIDOR ON(PRODUTO_CONSUMIDOR.FK_CON_CPF = CONSUMIDOR.CON_CPF);

/*INNER JOING
4 RETORNAR ApENAS OS CONSUMIDORES QUE COMPRARAM PRODUTOS */
SELECT		PRODUTO.PRO_NOME AS "NOME DO PRODUTO",
			CONSUMIDOR.CON_NOME AS "NOME DO CONSUMIDOR"
FROM		PRODUTO_CONSUMIDOR 
INNER JOIN PRODUTO ON (PRODUTO_CONSUMIDOR.FK_PRO_ID = PRODUTO.PRO_ID)
INNER JOIN CONSUMIDOR ON(PRODUTO_CONSUMIDOR.FK_CON_CPF = CONSUMIDOR.CON_CPF);

/*5 NOME DO SUP E QNTD DE PROD CADASTRADOS*/
SELECT SUPERMERCADO.SUP_RAZAO_SOCIAL AS "RAZAO SOCIAL",
COUNT(PRODUTO.PRO_ID)
FROM SUPERMERCADO_PRODUTO
INNER JOIN SUPERMERCADO ON(SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ)
INNER JOIN PRODUTO ON (SUPERMERCADO_PRODUTO.FK_PRO_ID = PRODUTO.PRO_ID)
GROUP BY SUPERMERCADO.SUP_RAZAO_SOCIAL;

/*	EXERCICIOS AULA DE HOJE 
	LEFT JOIN                
*/

/*ativ 1
*/

SELECT	SUPERMERCADO.SUP_RAZAO_SOCIAL,
		PRODUTO.PRO_NOME
FROM	SUPERMERCADO
LEFT JOIN SUPERMERCADO_PRODUTO ON(SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ)
LEFT JOIN PRODUTO ON(PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID);

/*ativ 2
*/

SELECT		FUNCIONARIO.FUN_NOME,
			SUPERMERCADO.SUP_RAZAO_SOCIAL
FROM		FUNCIONARIO
LEFT JOIN	SUPERMERCADO ON(SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*ativ 3
*/

SELECT		CONSUMIDOR.CON_NOME,
			PRODUTO.PRO_NOME
FROM		CONSUMIDOR 
LEFT JOIN PRODUTO_CONSUMIDOR ON(PRODUTO_CONSUMIDOR.FK_CON_CPF = CONSUMIDOR.CON_CPF)
LEFT JOIN PRODUTO ON (PRODUTO_CONSUMIDOR.FK_PRO_ID = PRODUTO.PRO_ID);

/*ativ 4
*/

SELECT		PRODUTO.PRO_NOME,
			CONSUMIDOR.CON_NOME
FROM		PRODUTO
LEFT JOIN PRODUTO_CONSUMIDOR ON (PRODUTO_CONSUMIDOR.FK_PRO_ID = PRODUTO.PRO_ID)
LEFT JOIN CONSUMIDOR ON(PRODUTO_CONSUMIDOR.FK_CON_CPF = CONSUMIDOR.CON_CPF);

/*ativ 5
*/

SELECT		SUPERMERCADO.SUP_RAZAO_SOCIAL,
			FUNCIONARIO.FUN_NOME
FROM		SUPERMERCADO
LEFT JOIN	FUNCIONARIO ON(SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*	ATIVIDADE PARTE2
	RIGH JOIN
*/

/*ATIV 1
*/

SELECT	SUPERMERCADO.SUP_RAZAO_SOCIAL,
		PRODUTO.PRO_NOME
FROM	SUPERMERCADO
RIGHT JOIN SUPERMERCADO_PRODUTO ON(SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ)
RIGHT JOIN PRODUTO ON(PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID);

/*ATIV 2
*/

SELECT		CONSUMIDOR.CON_NOME,
			PRODUTO.PRO_NOME
FROM		CONSUMIDOR 
RIGHT JOIN PRODUTO_CONSUMIDOR ON(PRODUTO_CONSUMIDOR.FK_CON_CPF = CONSUMIDOR.CON_CPF)
RIGHT JOIN PRODUTO ON (PRODUTO_CONSUMIDOR.FK_PRO_ID = PRODUTO.PRO_ID);

/*ATIV 3
*/

SELECT		FUNCIONARIO.FUN_NOME,
			SUPERMERCADO.SUP_RAZAO_SOCIAL
FROM		FUNCIONARIO
RIGHT JOIN	SUPERMERCADO ON(SUPERMERCADO.SUP_CNPJ = FUNCIONARIO.FK_SUP_CNPJ);

/*ATIV 4
*/

SELECT	SUPERMERCADO.SUP_RAZAO_SOCIAL,
		PRODUTO.PRO_NOME
FROM	SUPERMERCADO
RIGHT JOIN SUPERMERCADO_PRODUTO ON(SUPERMERCADO.SUP_CNPJ = SUPERMERCADO_PRODUTO.FK_SUP_CNPJ)
RIGHT JOIN PRODUTO ON(PRODUTO.PRO_ID = SUPERMERCADO_PRODUTO.FK_PRO_ID);

/*ATIV 5 
*/

SELECT		CONSUMIDOR.CON_NOME,
			PRODUTO.PRO_NOME
FROM		CONSUMIDOR 
RIGHT JOIN PRODUTO_CONSUMIDOR ON(PRODUTO_CONSUMIDOR.FK_CON_CPF = CONSUMIDOR.CON_CPF)
RIGHT JOIN PRODUTO ON (PRODUTO_CONSUMIDOR.FK_PRO_ID = PRODUTO.PRO_ID);

/*05/11/2025 Atividades*/
/*Selecionar apenas os PRODUTOS que possuem registro 
em um SUPERMERCADO e que foram comprados por um consumidor*/

SELECT	P.PRO_NOME			AS "NOME DO PRODUTO",
		P.PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
        P.PRO_PRECO 		AS "PRECO DO PRODUTO"
FROM 	PRODUTO P
WHERE	P.PRO_ID IN (SELECT SP.FK_PRO_ID FROM SUPERMERCADO_PRODUTO SP)
AND P.PRO_ID IN 	(SELECT PC.FK_PRO_ID FROM PRODUTO_CONSUMIDOR PC);

/*Selecionar apenas os PRODUTOS que NÃO possuem registro 
em um SUPERMERCADO e que NÃO foram comprados por um consumidor*/

SELECT	P.PRO_NOME			AS "NOME DO PRODUTO",
		P.PRO_CODIGO_BARRAS AS "CÓDIGO DE BARRAS",
        P.PRO_PRECO 		AS "PRECO DO PRODUTO"
FROM 	PRODUTO P
WHERE	P.PRO_ID NOT IN (SELECT SP.FK_PRO_ID FROM SUPERMERCADO_PRODUTO SP)
AND P.PRO_ID NOT IN 	(SELECT PC.FK_PRO_ID FROM PRODUTO_CONSUMIDOR PC);

/*Selecionar os SUPERMERCADOS que tem o preço de todos os produtos 
menor que 10.*/

SELECT	S.SUP_RAZAO_SOCIAL 
FROM	SUPERMERCADO S
WHERE	10 > ALL (
	SELECT	P.PRO_PRECO
    FROM	PRODUTO P
);

/*Listar todos os PRODUTOS cujo preço seja maior que o preço de
qualquer PRODUTO vendido no SUPERMERCADO com CNPJ 12345678000101*/

SELECT 	PRO_NOME,
		PRO_PRECO
FROM	PRODUTO
WHERE	PRO_PRECO > ANY(
	SELECT		P.PRO_PRECO
    FROM		PRODUTO P
	INNER JOIN	SUPERMERCADO_PRODUTO SP
    ON			(P.PRO_ID = SP.FK_PRO_ID)
    WHERE		SP.FK_SUP_CNPJ = '12345678000101'
);

/*Listar todos os consumidores que compraram pelo menos UM produto*/

SELECT	C.CON_NOME,
		C.CON_CPF
FROM 	CONSUMIDOR C
WHERE	EXISTS (
	SELECT 1
    FROM 	PRODUTO_CONSUMIDOR PC
    WHERE 	PC.FK_CON_CPF = C.CON_CPF
);

/*Listar todos os consumidores que NÃO compraram pelo menos UM produto*/

SELECT	C.CON_NOME,
		C.CON_CPF
FROM 	CONSUMIDOR C
WHERE	NOT EXISTS (
	SELECT 1
    FROM 	PRODUTO_CONSUMIDOR PC
    WHERE 	PC.FK_CON_CPF = C.CON_CPF
);

/*TCL
LINGUAGEM DE CONTROLE DE TRANSAÇÕES
COMMIT
*/
-- PASSO 1: INICIAR A TRENSAÇÃO

START TRANSACTION;

-- PASSO 2: ESCREVER O COMANDO DML

INSERT INTO SUPERMERCADO (	SUP_CNPJ, 
							SUP_RAZAO_SOCIAL, 
                            SUP_TELEFONE, 
                            SUP_EMAIL, 
                            SUP_ENDERECO_LOGRADOURO, 
                            SUP_ENDERECO_NUMERO, 
                            SUP_EDERECO_CIDADE, 
                            SUP_ENDERECO_ESTADO)
VALUES						('11111111000111',
							'Spermercado Pontes',
                            '11987654321',
                            'pontes@pontes.com',
                            'Rua do Pontes',
                            '100',
                            'Tambaú',
                            'SP');
                            
-- PASSO 3: SE TUDO DEU CERTO, ENVIA PRO BANCO

COMMIT;

/*ROLLBACK*/

-- PASSO 1: INICIAR A TRENSAÇÃO

START TRANSACTION;

-- PASSO 2: ESCREVER O COMANDO DML

INSERT INTO SUPERMERCADO (	SUP_CNPJ, 
							SUP_RAZAO_SOCIAL, 
                            SUP_TELEFONE, 
                            SUP_EMAIL, 
                            SUP_ENDERECO_LOGRADOURO, 
                            SUP_ENDERECO_NUMERO, 
                            SUP_EDERECO_CIDADE, 
                            SUP_ENDERECO_ESTADO)
VALUES						('11111111000111',
							'Spermercado Pontes',
                            '11987654321',
                            'pontes@pontes.com',
                            'Rua do Pontes',
                            '100',
                            'Tambaú',
                            'SP');
                            
-- PASSO 3: SE DER ERRO, NÃO ENVIA PRO BANCO

ROLLBACK;

START TRANSACTION;

-- Inserir um novo supermercado
INSERT INTO SUPERMERCADO (SUP_CNPJ, SUP_RAZAO_SOCIAL, SUP_TELEFONE, SUP_EMAIL, 
SUP_ENDERECO_LOGRADOURO, SUP_ENDERECO_NUMERO, SUP_EDERECO_CIDADE, SUP_ENDERECO_ESTADO)
VALUES('33333333000133', 'Supermercado Nova Era', '11987654321', 'contato@novaera.com.br',
'Rua Nova', '150', 'Porto Alegre', 'RS');

-- Criar um ponto de salvamenti (savepoint)
SAVEPOINT savepoint_produto1;

-- Inserir o primeiro produto
INSERT INTO PRODUTO (PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES ('1234567890987', 'Açucar 1kg', 100, 200, 3.00, '2025-06-30');

-- Criar um segundo ponto de salvamento (savepoint)
SAVEPOINT savepoint_produto2;

-- Inserir o segundo produto com um dado inválido (simulação de erro)
INSERT INTO PRODUTO (PRO_CODIGO_BARRAS, PRO_NOME, PRO_PESO, PRO_QUANTIDADE, PRO_PRECO, PRO_DATA_VALIDADE)
VALUES ('9876543210123', 'Café 500g', '500', -100, 15.00, '2025-09-30'); -- Quantidade negativa(erro)

-- Se ococrrer um erro, reverter apenas até o segundo savepoint
ROLLBACK TO savepoint_produto2;

-- Confirmar as mundanças até o primeiro savepoint
COMMIT;